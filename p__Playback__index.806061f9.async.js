(self.webpackChunkairview=self.webpackChunkairview||[]).push([[916],{6363:function(m,w,e){"use strict";e.r(w),e.d(w,{default:function(){return yr}});var f=e(97857),c=e.n(f),l=e(15009),n=e.n(l),v=e(99289),D=e.n(v),B=e(19632),I=e.n(B),le=e(5574),k=e.n(le),o=e(67294),Xe=e(53424),He=e(66151),Ze=e(18062),Ve=e(32955);const Ke="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let We=F=>crypto.getRandomValues(new Uint8Array(F)),Ue=(F,R,$)=>{let N=(2<<Math.log(F.length-1)/Math.LN2)-1,K=-~(1.6*N*R/F.length);return(J=R)=>{let G="";for(;;){let _=$(K),Z=K;for(;Z--;)if(G+=F[_[Z]&N]||"",G.length===J)return G}}},Tr=(F,R=21)=>Ue(F,R,We),ke=(F=21)=>{let R="",$=crypto.getRandomValues(new Uint8Array(F));for(;F--;)R+=Ke[$[F]&63];return R};var Cr=e(95534),xr=null,Mr=e(42404),Rr=null,Pr=e(69983),Dr=null,ze=e(37476),Oe=e(1413),Be=e(91),Je=e(86190),Qe=e(66758),qe=e(30798),O=e(85893),_e=["fieldProps","proFieldProps"],$e="dateTimeRange",er=o.forwardRef(function(F,R){var $=F.fieldProps,N=F.proFieldProps,K=(0,Be.Z)(F,_e),J=(0,o.useContext)(Qe.Z);return(0,O.jsx)(qe.Z,(0,Oe.Z)({ref:R,fieldProps:(0,Oe.Z)({getPopupContainer:J.getPopupContainer},$),valueType:$e,proFieldProps:N,filedConfig:{valueType:$e,customLightMode:!0,lightFilterLabelFormatter:function(_){return(0,Je.c)(_,"YYYY-MM-DD HH:mm:ss")}}},K))}),rr=er,nr=e(27484),X=e.n(nr),tr=e(90199),ar=function(R){var $=R.visible,N=R.onCancel,K=R.item,J=R.onOk,G=(0,o.useRef)(),_=function(){G.current&&G.current.resetFields()};(0,o.useEffect)(function(){_()},[]);var Z=function(){var j=D()(n()().mark(function T(W){return n()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:J(W),N(!1);case 2:case"end":return A.stop()}},T)}));return function(W){return j.apply(this,arguments)}}(),s=function(T,W){for(var Y=[],A=T;A<W;A++)Y.push(A);return Y},a=function(T){return T&&T>X()().endOf("day")},L=function(T){var W=X()().hours(),Y=X()().minutes(),A=X()().seconds();return T&&X()(T).date()===X()().date()?{disabledHours:function(){return s(W+1,24)},disabledMinutes:function(){return s(Y+1,60)},disabledSeconds:function(){return s(A+1,60)}}:{disabledHours:function(){return[]},disabledMinutes:function(){return[]},disabledSeconds:function(){return[]}}};return(0,O.jsx)(ze.Y,c()(c()({title:"\u4E0B\u8F7D\u5F55\u50CF\uFF08".concat(K==null?void 0:K.name,"\uFF09")},tr.I),{},{formRef:G,open:$,onFinish:function(){var j=D()(n()().mark(function T(W){return n()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:Z(W);case 1:case"end":return A.stop()}},T)}));return function(T){return j.apply(this,arguments)}}(),modalProps:{destroyOnClose:!0,onCancel:function(){N(!1)}},children:(0,O.jsx)(rr,{label:"\u9009\u62E9\u65F6\u95F4",name:"time",rules:[{required:!0}],initialValue:[X()().subtract(30,"minute").format("YYYY-MM-DD HH:mm:ss"),X()().format("YYYY-MM-DD HH:mm:ss")],fieldProps:{format:"YYYY-MM-DD HH:mm:ss",showSecond:!0,disabledDate:a,disabledTime:function(T){return L(T)}}})}))},ur=ar,ir=e(93967),lr=e.n(ir),sr=e(59628),or=e(44762),cr=e(43538),vr=e(96486),g=e(36493),dr={time_line_container:"time_line_container___WW4f_"},fr=function(R){var $=R.currentTime,N=R.timeParts,K=R.isMove,J=K===void 0?!1:K,G=R.changeCallback,_=R.resize,Z=(0,o.useRef)(null),s=(0,o.useRef)(null),a=(0,o.useRef)(),L=(0,o.useRef)($),j=(0,o.useRef)(N),T=(0,o.useRef)([1,2,5,10,15,20,30,60,120,180,240,360,720,1440]),W=20,Y=(0,o.useRef)(24),A=80,b=(0,o.useRef)(24),Ce=(0,o.useRef)(!1),fe="#3B5EFF",we="#DCDFE6",se="#606266",xe="#5674fd",Me="rgba(140, 158, 238 , .8)",Q=(0,o.useRef)(null),ue=(0,o.useRef)(0),Fe=function(){ue.current=L.current-Y.current*60*60*1e3/2},me=function(){var r,u,p;(r=a.current)===null||r===void 0||r.clearRect(0,0,((u=s.current)===null||u===void 0?void 0:u.width)||0,((p=s.current)===null||p===void 0?void 0:p.height)||0)},Le=function(){if(a.current){var r;a.current.fillStyle=we,a.current.fillRect(0,0,((r=s.current)===null||r===void 0?void 0:r.width)||0,15)}},Re=function(r){return r.getHours()===0&&r.getMinutes()===0&&r.getMilliseconds()===0?X()(r).format("YYYY-MM-DD"):X()(r).format("HH:mm")},Pe=(0,o.useCallback)(function(){if(!(!s.current||!a.current)){for(var d=s.current.width/(Y.current*60),r=d/(60*1e3),u=W,p=u/d,P=T.current.length,S=0;S<P;S+=1)if(p<T.current[S]){p=T.current[S],u=d*p;break}for(var Ee=30,de=0;de<P;de++)if(A/d<=T.current[de]){Ee=T.current[de];break}var Ae=s.current.width/u,C,t,i,h=L.current-Y.current*60*60*1e3/2,x=p*60*1e3-h%(p*60*1e3),H=x*r,y=u/r;a.current.fillStyle=se,a.current.font="14px Arial",a.current.strokeStyle=se,a.current.beginPath();for(var z=function(re,M){a.current&&(a.current.moveTo(re,0),a.current.lineTo(re,M),a.current.lineWidth=1)},V=0;V<Ae;V++){C=H+V*u,t=h+x+V*y;var ae=new Date(t);if(t/(60*1e3)%Ee===0){i=15;var ge=Re(ae);a.current.fillText(ge,C-20,30)}else i=10;z(C,i)}a.current.stroke()}},[]),De=function(){!s.current||!a.current||(a.current.beginPath(),a.current.moveTo(s.current.width/2,0),a.current.lineTo(s.current.width/2,32),a.current.strokeStyle=fe,a.current.lineWidth=2,a.current.stroke(),a.current.fillStyle=fe,a.current.fillText((0,g.mr)(L.current),s.current.width/2-60,s.current.height-15))},he=function(r){if(!(!s.current||!a.current)){var u=s.current.width/(Y.current*60*60*1e3),p=(r.start-ue.current)*u,P=(r.end-r.start)*u;r.style&&r.style.background?a.current.fillStyle=r.style.background:a.current.fillStyle=Me,a.current.fillRect(p,0,P,15)}},ee=(0,o.useCallback)(function(){Fe(),me(),Le(),Pe(),De(),j.current.length&&j.current.forEach(function(d){he(d)})},[Pe]),oe=function(r){if(Ce.current!==r){Ce.current=r;var u=function(){Q.current&&(clearInterval(Q.current),Q.current=null)};r?(Q.current&&u(),Q.current=setInterval(function(){L.current+=1e3,ee()},1e3)):u()}},ce=(0,vr.throttle)(function(){s.current&&Z.current&&(s.current.width=Z.current.clientWidth,s.current.height=Z.current.clientHeight),ee()},1e3);(0,o.useEffect)(function(){$&&(L.current=$),N&&(j.current=N),oe(J)},[$,N,J]),(0,o.useEffect)(function(){var d;return ce(),a.current=(d=s.current)===null||d===void 0?void 0:d.getContext("2d"),ee(),window.addEventListener("resize",ce),function(){window.removeEventListener("resize",ce),me(),Q.current&&(clearInterval(Q.current),Q.current=null)}},[]),(0,o.useEffect)(function(){ce()},[_]);var ne=(0,o.useRef)(!1),te=(0,o.useRef)(!1),ie=(0,o.useRef)(0),Ie=function(r){r.preventDefault();var u=Math.max(-1,Math.min(1,-r.deltaY));u<0?(b.current+=4,b.current>=24&&(b.current=24),Y.current=b.current):u>0&&(b.current-=4,b.current<=1&&(b.current=1),Y.current=b.current),ee()},be=function(r){if(!(!a.current||!s.current)){var u=ve(r),p=s.current.width/(Y.current*60*60*1e3),P=new Date(ue.current+u/p);return P}},pe=function(r){if(!(!a.current||!s.current)){var u=ve(r),p=be(r);ee(),a.current.beginPath(),a.current.moveTo(u+1,0),a.current.lineTo(u+1,s.current.height),a.current.strokeStyle=xe,a.current.lineWidth=1,a.current.stroke(),a.current.fillStyle=xe,a.current.fillText((0,g.mr)(p),u-50,s.current.height-10)}},ve=function(r){var u,p=document.documentElement.scrollLeft||document.body.scrollLeft,P=r.pageX||r.clientX+p,S=((u=s.current)===null||u===void 0?void 0:u.getBoundingClientRect().x)||0;return P-S},je=function(r){if(!(!a.current||!s.current)){var u=ve(r),p=u-ie.current,P=s.current.width/(Y.current*60*60*1e3),S=L.current;L.current=S-Math.round(p/P),ee(),ie.current=u}},Ye=function(r){var u,p=((u=be(r))===null||u===void 0?void 0:u.getTime())||0;L.current=p},q=(0,o.useRef)(0),Se=(0,o.useRef)(),E={wheel:function(r){Ie(r),pe(r)},mousedown:function(r){ne.current=!0;var u=ve(r);ie.current=u},mousemove:function(r){ne.current?(te.current=!0,je(r)):pe(r)},mouseup:function(r){if(q.current++,q.current>2){ne.current=!1,te.current=!1;return}!te.current&&q.current===2&&(Ye(r),pe(r)),Se.current=setTimeout(function(){q.current===1?q.current=0:q.current>1&&(q.current=0,G(L.current))},300),ne.current&&te.current&&q.current===1&&G(L.current),ne.current=!1,te.current=!1},mouseleave:function(){ee(),ne.current=!1,te.current=!1}};return(0,o.useEffect)(function(){var d,r,u,p,P;(d=s.current)===null||d===void 0||d.addEventListener("wheel",E.wheel),(r=s.current)===null||r===void 0||r.addEventListener("mousedown",E.mousedown),(u=s.current)===null||u===void 0||u.addEventListener("mousemove",E.mousemove),(p=s.current)===null||p===void 0||p.addEventListener("mouseup",E.mouseup),(P=s.current)===null||P===void 0||P.addEventListener("mouseleave",E.mouseleave);var S=s.current;return function(){S==null||S.removeEventListener("wheel",E.wheel),S==null||S.removeEventListener("mousedown",E.mousedown),S==null||S.removeEventListener("mousemove",E.mousemove),S==null||S.removeEventListener("mouseup",E.mouseup),S==null||S.removeEventListener("mouseleave",E.mouseleave)}},[G,E.mousedown,E.mouseleave,E.mousemove,E.mouseup,E.wheel]),(0,O.jsx)("div",{className:dr.time_line_container,ref:Z,children:(0,O.jsx)("canvas",{ref:s})})},mr=(0,o.memo)(fr),hr=e(67419),pr=e(68296),Sr=e(16097),Ne=e(94132),ye=e(54693),Te={split_view_container:"split_view_container___8gJ_P",bottom_wrap:"bottom_wrap___CC9A1",tree_container:"tree_container___Tii4n",content_container:"content_container___O2Cp6"},gr=function(){var R=(0,o.useState)(4),$=k()(R,2),N=$[0],K=$[1],J=(0,o.useState)([]),G=k()(J,2),_=G[0],Z=G[1],s=(0,o.useState)(0),a=k()(s,2),L=a[0],j=a[1],T=(0,o.useState)(0),W=k()(T,2),Y=W[0],A=W[1],b=(0,o.useRef)([]),Ce=(0,o.useState)([]),fe=k()(Ce,2),we=fe[0],se=fe[1],xe=(0,o.useState)(new Date().getTime()),Me=k()(xe,2),Q=Me[0],ue=Me[1],Fe=(0,o.useState)(!0),me=k()(Fe,2),Le=me[0],Re=me[1],Pe=(0,o.useState)(!1),De=k()(Pe,2),he=De[0],ee=De[1],oe=(0,Xe.useSnapshot)(ye.ZP);(0,o.useEffect)(function(){var C=I()(Array(16)).map(function(){return{url:"",name:""}});Z(C)},[]);var ce=function(t){K(t),j(0)},ne=function(){var C=D()(n()().mark(function t(i,h,x,H,y){var z,V,ae,ge,U;return n()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return z=432e5,V=H?(0,g.hK)(H)-z:(0,g.hK)()-z*2,ae=H?(0,g.hK)(H)+z:X()().endOf("day"),M.next=5,(0,Ne.Q$)({channel_id:h,device_id:i,start_time:(0,g.mr)(V,g.Rf),end_time:(0,g.mr)(ae,g.Rf),device_type:y||""});case 5:ge=M.sent,U=ge.records.map(function(Ge){return{start:X()(Ge.start_time).valueOf(),end:X()(Ge.end_time).valueOf()}}),se(U),b.current[x].timeParts=U;case 9:case"end":return M.stop()}},t)}));return function(i,h,x,H,y){return C.apply(this,arguments)}}(),te=function(){var C=D()(n()().mark(function t(i){var h,x;return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return h=(0,g.hK)(i.time)>=(0,g.hK)()?X()().subtract(1,"days").valueOf():i.time,y.prev=1,y.next=4,(0,Ne.EF)({device_id:i.device_id,channel_id:i.channel_id,play_type:i.play_type||"REALTIME",start_time:i.play_type?(0,g.mr)(h,g.Rf):"",end_time:i.play_type?(0,g.mr)(null,g.Rf):"",device_type:i.device_type||""});case 4:return x=y.sent,y.abrupt("return",x.play_url);case 8:y.prev=8,y.t0=y.catch(1),console.log(y.t0);case 11:return y.abrupt("return","");case 12:case"end":return y.stop()}},t,null,[[1,8]])}));return function(i){return C.apply(this,arguments)}}(),ie=function(){var C=D()(n()().mark(function t(i){var h,x,H,y,z,V,ae;return n()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return h=i.index,x=i.device_id,H=i.channel_id,y=i.time,z=i.name,V=i.device_type,Re(!1),Z(function(re){var M=I()(re);return M[h].url="",M[h].stauts="loading",M[h].name="",M[h].device_id=x,M[h].channel_id=H,M[h].device_type=V,I()(M)}),U.next=5,te(i);case 5:if(ae=U.sent,y||ue((0,g.hK)()),ae){U.next=10;break}return Z(function(re){var M=I()(re);return M[i.index].stauts="fail",I()(M)}),U.abrupt("return");case 10:return Z(function(re){var M=I()(re);return M[h].url=ae,M[h].stauts="completed",M[h].name=z,I()(M)}),b.current[h]={device_id:x,channel_id:H,currentTime:y,device_type:i.device_type},U.next=14,ne(x,H,h,y,i.device_type);case 14:case"end":return U.stop()}},t)}));return function(i){return C.apply(this,arguments)}}(),Ie=function(t){ie({device_id:t.parentId,channel_id:t.channelId||"",index:L,name:t.name,device_type:t.device_type})},be=function(t){j(t),A(t)},pe=function(t){ie({device_id:t.parentId,channel_id:t.channelId||"",index:Y,name:t.name,device_type:t.device_type})},ve=function(t){var i=(0,g.hK)()-12e4>t,h=t>(0,g.hK)()?(0,g.hK)():t;ue(i?h:(0,g.hK)());var x=b.current[L];x&&ie({device_id:x.device_id,channel_id:x.channel_id,index:L,time:h,play_type:i?"RECORD":void 0,name:x.name,device_type:x.device_type})},je=function(t){j(t);var i=b.current[t],h=i!=null&&i.currentTime?i.currentTime:(0,g.hK)();if(ue(h),!i){se([]);return}se(i.timeParts)},Ye=function(){var t=b.current[L];t!=null&&t.currentTime&&(t.time&&clearInterval(t.time),t.time=setInterval(function(){t.currentTime+=1e3},1e3))},q=(0,Sr.Z)(),Se=k()(q,3),E=Se[0],d=Se[1],r=Se[2],u=(0,pr.Em)(),p=k()(u,2),P=p[0],S=p[1],Ee=function(t){S(!0,t)},de=function(t){var i,h,x,H,y=t.time,z={device_id:((i=P.param)===null||i===void 0?void 0:i.device_id)||"",channel_id:((h=P.param)===null||h===void 0?void 0:h.channel_id)||"",device_type:((x=P.param)===null||x===void 0?void 0:x.device_type)||"",start_time:(0,g.mr)(y[0],g.Rf),end_time:(0,g.mr)(y[1],g.Rf),id:ke()};if(oe.topicState!==Ve.i.CONNECTED){var V;(V=oe.subscribe)===null||V===void 0||V.call(oe,!0)}console.log("changeSocket\u7684socket\u72B6\u6001\uFF1A",oe.topicState),ye.Nw.changeSocket(z),ye.Nw.addDownLoadItem(c()(c()({},z),{},{name:(H=P.param)===null||H===void 0?void 0:H.name,create_time:(0,g.mr)(),serverStatus:ye.X2.UPLOADING})),sr.yw.success("\u5DF2\u6DFB\u52A0\u81F3\u4E0B\u8F7D\u7BA1\u7406\u5217\u8868")},Ae=E||he;return(0,O.jsxs)(He.Z,{split:"vertical",className:Te.split_view_container,bodyStyle:{flexWrap:"wrap"},ref:r,children:[(0,O.jsx)(or.Z,{currentGrid:N,onClick:function(t){return ce(t)},isCloseTree:he,changeCloseTree:ee,changeFull:d,fullscreen:E}),(0,O.jsxs)("div",{className:Te.bottom_wrap,style:{display:"flex"},children:[(0,O.jsx)(Ze.Z,{className:lr()(Te.tree_container,Ae&&"!w-0 !overflow-hidden !p-0"),children:(0,O.jsx)(hr.Z,{onChange:Ie,onDragEnd:pe})}),(0,O.jsxs)(He.Z,{className:Te.content_container,bodyStyle:{padding:0},children:[(0,O.jsx)("div",{style:{height:"calc(100vh - ".concat(E?"96px":"190px",")")},children:(0,O.jsx)(cr.Z,{currentGrid:N,videoListData:_,currentSelectIndex:L,onChangeSelectGrig:je,onDrop:be,onSuccess:function(){Re(!0),Ye()},onDownload:Ee})}),(0,O.jsx)(mr,{currentTime:Q,timeParts:we,isMove:Le,changeCallback:ve,resize:he})]})]}),(0,O.jsx)(ur,{visible:P.visible,item:P.param,onCancel:function(){return S(!1)},onOk:de})]})},yr=gr},94311:function(m,w,e){var f=e(69877);function c(l){var n=l.length;return n?l[f(0,n-1)]:void 0}m.exports=c},26891:function(m,w,e){var f=e(29750),c=e(6450),l=e(73480);function n(v,D){return l(c(v),f(D,0,v.length))}m.exports=n},70151:function(m,w,e){var f=e(6450),c=e(73480);function l(n){return c(f(n))}m.exports=l},69877:function(m){var w=Math.floor,e=Math.random;function f(c,l){return c+w(e()*(l-c+1))}m.exports=f},84992:function(m,w,e){var f=e(94311),c=e(52628);function l(n){return f(c(n))}m.exports=l},60726:function(m,w,e){var f=e(29750),c=e(73480),l=e(52628);function n(v,D){var B=l(v);return c(B,f(D,0,B.length))}m.exports=n},25127:function(m,w,e){var f=e(73480),c=e(52628);function l(n){return f(c(n))}m.exports=l},47415:function(m,w,e){var f=e(29932);function c(l,n){return f(n,function(v){return l[v]})}m.exports=c},73480:function(m,w,e){var f=e(69877);function c(l,n){var v=-1,D=l.length,B=D-1;for(n=n===void 0?D:n;++v<n;){var I=f(v,B),le=l[I];l[I]=l[v],l[v]=le}return l.length=n,l}m.exports=c},95534:function(m,w,e){var f=e(94311),c=e(84992),l=e(1469);function n(v){var D=l(v)?f:c;return D(v)}m.exports=n},42404:function(m,w,e){var f=e(26891),c=e(60726),l=e(1469),n=e(16612),v=e(40554);function D(B,I,le){(le?n(B,I,le):I===void 0)?I=1:I=v(I);var k=l(B)?f:c;return k(B,I)}m.exports=D},69983:function(m,w,e){var f=e(70151),c=e(25127),l=e(1469);function n(v){var D=l(v)?f:c;return D(v)}m.exports=n},18601:function(m,w,e){var f=e(14841),c=1/0,l=17976931348623157e292;function n(v){if(!v)return v===0?v:0;if(v=f(v),v===c||v===-c){var D=v<0?-1:1;return D*l}return v===v?v:0}m.exports=n},40554:function(m,w,e){var f=e(18601);function c(l){var n=f(l),v=n%1;return n===n?v?n-v:n:0}m.exports=c},52628:function(m,w,e){var f=e(47415),c=e(3674);function l(n){return n==null?[]:f(n,c(n))}m.exports=l}}]);
