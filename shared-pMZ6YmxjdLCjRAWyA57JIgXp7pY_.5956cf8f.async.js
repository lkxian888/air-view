(self.webpackChunkairview=self.webpackChunkairview||[]).push([[480],{32955:function(L,R,f){"use strict";f.d(R,{i:function(){return l}});var Z=f(67294),l=function(O){return O.CONNECTED="connected",O.UNCONNECTED="unconnected",O}({}),Q=null;function M(O){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=useRef(nanoid()),U=useRef(new Map),oe=useState(l.UNCONNECTED),W=_slicedToArray(oe,2),I=W[0],m=W[1],ie=useState(null),se=_slicedToArray(ie,2),A=se[0],ve=se[1],z=useState(null),ue=_slicedToArray(z,2),P=ue[0],N=ue[1],Y=useContext(SocketContext),$=C.auto,H=$===void 0?!0:$,K=C.meta,X=K===void 0?{}:K,q=C.onSuccess,pe=C.onError,de=C.errorAdaptor,he=C.onConnected,ye=C.onUnconnected,ee=useLatest(q),k=useLatest(pe),J=useLatest(he),te=useLatest(ye),ce=useLatest(de),ne=usePrevious(I);if(Y===null)throw new Error("useTopicSubscribe \u5FC5\u987B\u5728 SocketProvider \u4E2D\u4F7F\u7528");var B=useMemo(function(){var p=O.apiUrl;if(typeof p!="string")throw new Error("\u8BF7\u4F20\u5165\u5185\u90E8 OpenAPI \u5DE5\u5177\u751F\u6210\u7684\u8BF7\u6C42\u51FD\u6570");var w=p.split("/"),a=w.pop(),t=w.pop();if(!a||!t)throw new Error("topic \u89E3\u6790\u51FA\u9519");return{service:t,method:a}},[O]),G=useWebSocket(Y.socketUrl,{share:!0,filter:filterPong,protocols:getAuthToken,shouldReconnect:function(){return!1},onClose:function(){m(l.UNCONNECTED)},onError:function(){m(l.UNCONNECTED)}}),x=G.sendJsonMessage,h=G.lastJsonMessage,V=G.readyState,re=useCallback(function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;x(_objectSpread({channelId:j.current,event:p?"sub":"unsub",payload:{},meta:X},B),w)},[x,B]);function g(p,w){var a=w||{},t=a.keep,e=t===void 0?!1:t,n=a.trace,r=n===void 0?!1:n;if(r){var o=nanoid();return new Promise(function(c,s){if(!U.current.has(o))U.current.set(o,{resolve:c,reject:s}),x(_objectSpread({channelId:j.current,event:"send",payload:_objectSpread(_objectSpread({},p),{},{traceId:o})},B),e);else{var u,i=new Error("\u8BF7\u6C42 ID \u91CD\u590D");N(i),(u=k.current)===null||u===void 0||u.call(k,i),s(i)}})}else return x(_objectSpread({channelId:j.current,event:"send",payload:p},B),e)}var F=useCallback(g,[x]);return useEffect(function(){var p;if(h&&h.channelId===j.current){var w=h.payload||{},a=w.traceId,t=a===void 0?"":a,e=U.current.get(t)||{},n=e.resolve,r=e.reject,o=function(){n&&r&&t&&U.current.delete(t)};switch(h.event){case"result":var c=typeof ce.current=="function"?ce.current(h.payload):["OK",0].includes(h.payload.code);if(c){var s;ve(h.payload),N(null),m(l.CONNECTED),(s=ee.current)===null||s===void 0||s.call(ee,h.payload),n&&n(h.payload)}else{var u,i=new Error(h.payload.msg);i.info=h.payload,N(i),m(l.CONNECTED),(u=k.current)===null||u===void 0||u.call(k,i),r&&r(i)}o();break;case"error":var y=new Error("\u670D\u52A1\u5668\u53D1\u751F\u9519\u8BEF");y.info=h.payload,N(y),m(l.UNCONNECTED),(p=k.current)===null||p===void 0||p.call(k,y),r&&r(y),o();break;case l.CONNECTED:m(l.CONNECTED);break;case l.UNCONNECTED:m(l.UNCONNECTED);break;default:break}}},[h]),useEffect(function(){V===ReadyState.OPEN&&H&&re()},[V]),useEffect(function(){return function(){H&&re(!1)}},[]),useEffect(function(){if(ne===l.UNCONNECTED&&I===l.CONNECTED){var p;(p=J.current)===null||p===void 0||p.call(J,F)}if(ne===l.CONNECTED&&I===l.UNCONNECTED){var w;(w=te.current)===null||w===void 0||w.call(te)}},[ne,I]),{topicState:I,data:A,error:P,send:F,subscribe:re,channelIdRef:j}}var fe=null},54693:function(L,R,f){"use strict";f.d(R,{X2:function(){return h},Nw:function(){return p},ZP:function(){return w}});var Z=f(15009),l=f.n(Z),Q=f(99289),M=f.n(Q),fe=f(97857),O=f.n(fe),C=f(32955),j=f(9783),U=f(81491),oe=f(52677),W=f(5574),I=f(13769),m=f(22979),ie=null;function se(a,t,e,n){var r=a[t];return _subscribe(a,function(){var o=a[t];Object.is(r,o)||e(r=o)},n)}var A;function ve(a,t){var e=!0,n=new Set,r=new Map,o=function(){e&&(e=!1,n.forEach(function(u){return u()}),n.clear(),r.forEach(function(u){return u()}),r.clear())},c=function s(){if(e){n.forEach(function(E){return E()}),n.clear();var u=new Set,i=A;A=n;try{var y=a(function(E){return u.add(E),E});y&&n.add(y)}finally{A=i}r.forEach(function(E,d){u.has(d)?u.delete(d):(r.delete(d),E())}),u.forEach(function(E){var d=_subscribe(E,s,t==null?void 0:t.sync);r.set(E,d)})}};return A&&A.add(o),c(),o}var z=Symbol();function ue(a,t){typeof t=="string"&&(console.warn("string name option is deprecated, use { name }. https://github.com/pmndrs/valtio/pull/400"),t={name:t});var e=t||{},n=e.enabled,r=e.name,o=r===void 0?"":r,c=_objectWithoutProperties(e,ie),s;try{s=(n!=null?n:!0)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(d){}if(!s){n&&console.warn("[Warning] Please install/enable Redux devtools extension");return}var u=!1,i=s.connect(_objectSpread({name:o},c)),y=_subscribe(a,function(d){var T=d.filter(function(v){var b=_slicedToArray(v,2),D=b[0],_=b[1];return _[0]!==z}).map(function(v){var b=_slicedToArray(v,2),D=b[0],_=b[1];return"".concat(D,":").concat(_.map(String).join("."))}).join(", ");if(T)if(u)u=!1;else{var S=Object.assign({},snapshot(a));delete S[z],i.send({type:T,updatedAt:new Date().toLocaleString()},S)}}),E=i.subscribe(function(d){var T,S,v,b,D,_;if(d.type==="ACTION"&&d.payload)try{Object.assign(a,JSON.parse(d.payload))}catch(le){console.error(`please dispatch a serializable value that JSON.parse() and proxy() support
`,le)}if(d.type==="DISPATCH"&&d.state){if(((T=d.payload)==null?void 0:T.type)==="JUMP_TO_ACTION"||((S=d.payload)==null?void 0:S.type)==="JUMP_TO_STATE"){u=!0;var ae=JSON.parse(d.state);Object.assign(a,ae)}a[z]=d}else if(d.type==="DISPATCH"&&((v=d.payload)==null?void 0:v.type)==="COMMIT")i.init(snapshot(a));else if(d.type==="DISPATCH"&&((b=d.payload)==null?void 0:b.type)==="IMPORT_STATE"){var be=(D=d.payload.nextLiftedState)==null?void 0:D.actionsById,ge=((_=d.payload.nextLiftedState)==null?void 0:_.computedStates)||[];u=!0,ge.forEach(function(le,Ee){var Se=le.state,we=be[Ee]||"No action found";Object.assign(a,Se),Ee===0?i.init(snapshot(a)):i.send(we,snapshot(a))})}});return i.init(snapshot(a)),function(){y(),E==null||E()}}var P=new WeakMap,N=new WeakMap,Y=function a(t,e){var n=P.get(t);n&&(n[0].forEach(function(r){var o=r.d;t!==o&&a(o)}),++n[2],e&&n[3].add(e))},$=function(t,e){var n=P.get(t);return n!=null&&n[2]?(n[3].add(e),!0):!1},H=function a(t){var e=P.get(t);e&&(--e[2],e[2]||(e[3].forEach(function(n){return n()}),e[3].clear()),e[0].forEach(function(n){var r=n.d;t!==r&&a(r)}))},K=function(t){var e=t.s,n=t.d,r=N.get(n);r||(r=[new Set],N.set(t.d,r)),r[0].add(t);var o=P.get(e);if(!o){var c=new Set,s=(0,m.Ld)(e,function(u){c.forEach(function(i){var y=i.d,E=i.c,d=i.n,T=i.i;e===y&&u.every(function(S){return S[1].length===1&&T.includes(S[1][0])})||i.p||(Y(e,E),d?H(e):i.p=Promise.resolve().then(function(){delete i.p,H(e)}))})},!0);o=[c,s,0,new Set],P.set(e,o)}o[0].add(t)},X=function(t){var e=t.s,n=t.d,r=N.get(n);r==null||r[0].delete(t),(r==null?void 0:r[0].size)===0&&N.delete(n);var o=P.get(e);if(o){var c=W(o,2),s=c[0],u=c[1];s.delete(t),s.size||(u(),P.delete(e))}},q=function(t){var e=N.get(t);return e?Array.from(e[0]):[]},pe={add:K,remove:X,list:q};function de(a,t){var e=(t==null?void 0:t.proxy)||proxy({}),n=!!(t!=null&&t.sync),r=Object.keys(a);return r.forEach(function(o){if(Object.getOwnPropertyDescriptor(e,o))throw new Error("object property already defined");var c=a[o],s=null,u=function i(){if(!(s&&(Array.from(s).map(function(S){var v=_slicedToArray(S,1),b=v[0];return $(b,i)}).some(function(S){return S})||Array.from(s).every(function(S){var v=_slicedToArray(S,2),b=v[0],D=v[1];return getVersion(b)===D.v})))){var y=new Map,E=function(v){return y.set(v,{v:getVersion(v)}),v},d=c(E),T=function(){y.forEach(function(v,b){var D,_=(D=s==null?void 0:s.get(b))==null?void 0:D.s;if(_)v.s=_;else{var ae={s:b,d:e,k:o,c:i,n,i:r};K(ae),v.s=ae}}),s==null||s.forEach(function(v,b){!y.has(b)&&v.s&&X(v.s)}),s=y};d instanceof Promise?d.finally(T):T(),e[o]=d}};u()}),e}function he(a,t){var e=t!=null&&t.delete?new Set:null;q(a).forEach(function(n){var r=n.k;(!(t!=null&&t.keys)||t.keys.includes(r))&&(X(n),e&&e.add(r))}),e&&e.forEach(function(n){delete a[n]})}function ye(a,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:a;console.warn("addComputed is deprecated. Please consider using `derive`. Falling back to emulation with derive. https://github.com/pmndrs/valtio/pull/201");var n={};return Object.keys(t).forEach(function(r){n[r]=function(o){return t[r](o(a))}}),de(n,{proxy:e})}function ee(a,t){console.warn('proxyWithComputed is deprecated. Please follow "Computed Properties" guide in docs.'),Object.keys(t).forEach(function(n){if(Object.getOwnPropertyDescriptor(a,n))throw new Error("object property already defined");var r=t[n],o=typeof r=="function"?{get:r}:r,c=o.get,s=o.set,u={};u.get=function(){return c((0,m.CO)(e))},s&&(u.set=function(i){return s(e,i)}),Object.defineProperty(a,n,u)});var e=(0,m.sj)(a);return e}var k=function(t){return _typeof(t)==="object"&&t!==null},J,te=function a(t){if(J||(J=unstable_buildProxyFunction()[2]),!k(t)||J.has(t))return t;var e=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return Reflect.ownKeys(t).forEach(function(n){e[n]=a(t[n])}),e};function ce(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=proxy({value:a,history:ref({wip:void 0,snapshots:[],index:-1}),clone:te,canUndo:function(){return e.history.index>0},undo:function(){e.canUndo()&&(e.value=e.history.wip=e.clone(e.history.snapshots[--e.history.index]))},canRedo:function(){return e.history.index<e.history.snapshots.length-1},redo:function(){e.canRedo()&&(e.value=e.history.wip=e.clone(e.history.snapshots[++e.history.index]))},saveHistory:function(){e.history.snapshots.splice(e.history.index+1),e.history.snapshots.push(snapshot(e).value),++e.history.index},subscribe:function(){return _subscribe(e,function(r){r.every(function(o){return o[1][0]==="value"&&(o[0]!=="set"||o[2]!==e.history.wip)})&&e.saveHistory()})}});return e.saveHistory(),t||e.subscribe(),e}function ne(a){var t=proxy(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineAccessor("get",{data:Array.from(new Set(a)),has:function(n){return this.data.indexOf(n)!==-1},add:function(n){var r=!1;return _typeof(n)==="object"&&n!==null&&(r=this.data.indexOf(proxy(n))!==-1),this.data.indexOf(n)===-1&&!r&&this.data.push(n),this},delete:function(n){var r=this.data.indexOf(n);return r===-1?!1:(this.data.splice(r,1),!0)},clear:function(){this.data.splice(0)},get size(){return this.data.length},forEach:function(n){var r=this;this.data.forEach(function(o){n(o,o,r)})}},Symbol.toStringTag,function(){return"Set"}),"toJSON",function(){return new Set(this.data)}),Symbol.iterator,function(){return this.data[Symbol.iterator]()}),"values",function(){return this.data.values()}),"keys",function(){return this.data.values()}),"entries",function(){return new Set(this.data).entries()}));return Object.defineProperties(t,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(t),t}function B(a){var t=proxy(_defineProperty(_defineAccessor("get",{data:Array.from(a||[]),has:function(n){return this.data.some(function(r){return r[0]===n})},set:function(n,r){var o=this.data.find(function(c){return c[0]===n});return o?o[1]=r:this.data.push([n,r]),this},get:function(n){var r;return(r=this.data.find(function(o){return o[0]===n}))==null?void 0:r[1]},delete:function(n){var r=this.data.findIndex(function(o){return o[0]===n});return r===-1?!1:(this.data.splice(r,1),!0)},clear:function(){this.data.splice(0)},get size(){return this.data.length},toJSON:function(){return new Map(this.data)},forEach:function(n){var r=this;this.data.forEach(function(o){n(o[1],o[0],r)})},keys:function(){return this.data.map(function(n){return n[0]}).values()},values:function(){return this.data.map(function(n){return n[1]}).values()},entries:function(){return new Map(this.data).entries()}},Symbol.toStringTag,function(){return"Map"}),Symbol.iterator,function(){return this.entries()}));return Object.defineProperties(t,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(t),t}var G=f(36493),x=f(94132),h=function(a){return a.UPLOADING="uploading",a.DONE="done",a.ERROR="error",a}({}),V=function(t){return function(e){return e.id===t}},re={device_id:"34020000001180000002",channel_id:"34020000001320000006",device_type:"GB28181",start_time:"2023-03-01 00:00:32",end_time:"2023-03-01 09:18:30",id:"vvvvvd",name:"IPC",create_time:"2023-03-06 09:33:17",download_url:"https://minio.uat.inrobot.cloud/quarantine/rc-upload-1675409448798-12",download_percentage:100,serverStatus:h.DONE},g=ee({downloadList:[],socketSend:void 0,xhrObjs:{},topicState:C.i.UNCONNECTED,subscribe:void 0},{downloadTableList:function(t){return t.downloadList}});function F(a){var t=g.downloadList.find(V(a)),e=g.downloadList.findIndex(V(a));return{target:t,index:e}}var p={addDownLoadItem:function(t){g.downloadList.unshift(t)},updatedDownLoadItem:function(t){var e=F(t.id),n=e.target,r=e.index;r===-1||!n||(n=O()(O()({},n),t),n.download_percentage===100&&n.serverStatus!==h.DONE&&(n.serverStatus=h.DONE,this.handleDownload(n)),g.downloadList.splice(r,1,n))},deleteDownLoadItem:function(t){var e=F(t),n=e.target,r=e.index;if(!(r===-1||!n)){if(n.serverStatus!==h.DONE&&this.stopDownload(n),typeof n.percentage=="number"&&n.percentage<100){var o;(o=g.xhrObjs[t])===null||o===void 0||o.stop(),delete g.xhrObjs[t],this.stopDownload(n)}g.downloadList.splice(r,1)}},handleDownload:function(t){var e=this;return M()(l()().mark(function n(){return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,G.Sv)({url:t.download_url,filename:"".concat(t.name,"-").concat(t.start_time,"-").concat(t.end_time),onProgress:function(s){var u=s.loaded,i=s.total,y=Math.round(u/i*100);e.updatedDownLoadItem(O()(O()({},t),{},{size:i,percentage:y})),console.log("Downloaded ".concat(y,"%"))},onError:function(s){console.log(s)},getXhr:function(s){g.xhrObjs[t.id]={stop:function(){return s.abort()}}}});case 2:e.stopDownload(t);case 3:case"end":return o.stop()}},n)}))()},stopDownload:function(t){return M()(l()().mark(function e(){var n,r,o,c,s;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=t.device_id,r=t.channel_id,o=t.device_type,c=t.download_url,s={device_id:n,channel_id:r,device_type:o,download_url:c},i.prev=2,i.next=5,(0,x.gH)(s);case 5:i.next=9;break;case 7:i.prev=7,i.t0=i.catch(2);case 9:case"end":return i.stop()}},e,null,[[2,7]])}))()},setSend:function(t){g.socketSend=t},setsubscribe:function(t){g.subscribe=t},setTopicState:function(t){g.topicState=t},changeSocket:function(t){var e;(e=g.socketSend)===null||e===void 0||e.call(g,t)}},w=g},81491:function(L){function R(f,Z,l,Q){var M={configurable:!0,enumerable:!0};return M[f]=Q,Object.defineProperty(Z,l,M)}L.exports=R,L.exports.__esModule=!0,L.exports.default=L.exports}}]);
